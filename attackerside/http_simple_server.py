from http.server import BaseHTTPRequestHandler, HTTPServer
import os

class RequestHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        try:
            # Specify the directory where your files are stored
            base_path = "./files"
            
            # Extract the requested file name from the URL
            file_path = os.path.join(base_path, self.path[1:])

            if os.path.isfile(file_path):
                with open(file_path, 'rb') as file:
                    content = file.read()

                self.send_response(200)
                self.send_header("Content-type", "application/octet-stream")
                self.send_header("Content-Disposition", f"attachment; filename={os.path.basename(file_path)}")
                self.end_headers()
                self.wfile.write(content)
                print(f"File {file_path} sent to {self.client_address[0]}")
            else:
                self.send_error(404, "File Not Found")
                print(f"File not found: {file_path}")

        except Exception as e:
            self.send_error(500, f"Internal Server Error: {e}")
            print(f"Internal Server Error: {e}")

if __name__ == "__main__":
    host = "192.168.1.30"
    port = 55555

    server_address = (host, port)
    httpd = HTTPServer(server_address, RequestHandler)

    print(f"Server started on {host}:{port}")

    try:
        httpd.serve_forever()
    except KeyboardInterrupt:
        print("Server shutting down")
        httpd.server_close()

